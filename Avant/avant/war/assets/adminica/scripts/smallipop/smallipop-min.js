(function(e){e.smallipop={version:"0.1.6",defaults:{popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,windowPadding:30,hideTrigger:!1,theme:"default",infoClass:"smallipopHint",triggerAnimationSpeed:150,popupAnimationSpeed:200,invertAnimation:!1,horizontal:!1,preferredPosition:"top",triggerOnClick:!1,touchSupport:!0,funcEase:"easeInOutQuad"},popup:null,lastId:1,hideSmallipop:function(){var t,n,r,i,s,o,u;r=e.smallipop;n=r.popup.data("shown");i=e(".smallipop"+n);s=i.data("options")||r.defaults;n&&s.hideTrigger&&i.stop(!0).fadeTo(s.triggerAnimationSpeed,1);t=s.invertAnimation?-1:1;o=r.popup.data("xDistance")*t;u=r.popup.data("yDistance")*t;return r.popup.data({hideDelayTimer:null,beingShown:!1}).stop(!0).animate({top:"-="+o+"px",left:"+="+u+"px",opacity:0},s.popupAnimationSpeed,s.funcEase,function(){var t;t=e(this);if(!t.data("beingShown"))return t.css("display","none").data("shown","")})},showSmallipop:function(t){var n;n=e.smallipop;n.popup.data("shown")!==e(this).data("id")&&t.preventDefault();return n.triggerMouseover.call(this)},onWindowClick:function(t){var n,r;r=e.smallipop;n=r.popup;if(t.target!==n[0]&&!e(t.target).closest(".sipInitialized").length)return r.hideSmallipop.call(this)},onTouchDevice:function(){return typeof Modernizr!="undefined"&&Modernizr!==null?Modernizr.touch:void 0},killTimers:function(){var t,n,r;n=e.smallipop.popup;t=n.data("hideDelayTimer");r=n.data("showDelayTimer");t&&clearTimeout(t);if(r)return clearTimeout(r)},triggerMouseover:function(){var t,n,r,i,s,o;i=e(this);t=i.data("id");o=e.smallipop;r=o.popup;s=r.data("shown");o.killTimers();r.data(t?"triggerHovered":"hovered",!0);if(t&&!r.data("beingShown")&&s!==t){n=i.data("options");return r.data("showDelayTimer",setTimeout(function(){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;if(!r.data("triggerHovered"))return;g=e(".smallipop"+s);y=g.data("options")||o.defaults;s&&y.hideTrigger&&g.stop(!0).fadeTo(y.fadeSpeed,1);r.removeClass().addClass(n.theme).data({beingShown:!0,shown:t}).find(".sipContent").html(i.data("hint"));b=e(window);x=T=n.popupDistance;N=n.popupYOffset;u=i.offset();f=r.outerHeight();h=r.outerWidth();a=h/2;E=b.width();w=b.height();v=i.outerWidth();d=i.outerHeight();S=n.windowPadding;l=u.left+v/2;c=u.top-f+N;if(n.horizontal){x=0;c+=d/2+f/2;if(n.preferredPosition==="left"&&u.left-h-n.popupOffset>S||u.left+v+h>E-S){r.addClass("sipPositionedLeft");l=u.left-h-n.popupOffset;T=-T}else{r.addClass("sipPositionedRight");l=u.left+v+n.popupOffset}}else{T=0;if(l+a>E-S){l-=a*2-n.popupOffset;r.addClass("sipAlignLeft")}else if(l-a<S){l-=n.popupOffset;r.addClass("sipAlignRight")}else l-=a;m=u.top-b.scrollTop();p=f+n.popupDistance-N;if(n.preferredPosition==="bottom"&&m+d+p<w-S||m-p<S){c+=f+d-2*N;x=-x;N=0;r.addClass("sipAlignBottom")}}n.hideTrigger&&e(".smallipop"+t).stop(!0).fadeTo(n.triggerAnimationSpeed,0);return r.data({xDistance:x,yDistance:T}).stop(!0).css({top:c,left:l,display:"block",opacity:0}).animate({top:"-="+x+"px",left:"+="+T+"px",opacity:1},n.popupAnimationSpeed,n.funcEase,function(){return r.data("beingShown",!1)})},n.popupDelay))}},triggerMouseout:function(){var t,n,r,i;r=e(this);i=e.smallipop;n=i.popup;t=r.data("id");i.killTimers();n.data(t?"triggerHovered":"hovered",!1);if(!n.data("hovered")&&!n.data("triggerHovered"))return n.data("hideDelayTimer",setTimeout(i.hideSmallipop,500))}};e.easing.easeInOutQuad||(e.easing.easeInOutQuad=function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n});return e.fn.smallipop=function(t,n){var r,i,s;t==null&&(t={});n==null&&(n="");i=e.smallipop;t=e.extend({},i.defaults,t);t.moveSpeed!=null&&(t.popupAnimationSpeed=t.moveSpeed);t.hideSpeed!=null&&(t.triggerAnimationSpeed=t.hideSpeed);s={};t.triggerOnClick||t.touchSupport&&i.onTouchDevice()?s={click:i.showSmallipop}:s={mouseover:i.triggerMouseover,mouseout:i.triggerMouseout,click:i.hideSmallipop};r=e("#smallipop");if(!r.length){r=i.popup=e('<div id="smallipop"><div class="sipContent clearfix"/><div class="sipArrowBorder"/><div class="sipArrow"/></div>').css("opacity",0).data({xDistance:0,yDistance:0}).bind({mouseover:i.triggerMouseover,mouseout:i.triggerMouseout});e("body").append(r);e("a",r.get(0)).live("click",i.hideSmallipop);e(document).bind("click touchend",i.onWindowClick)}return this.each(function(){var r,o,u;u=e(this);o=n||u.attr("title")||u.find("."+t.infoClass).html();if(o&&!u.hasClass("sipInitialized")){r=i.lastId++;u.addClass("sipInitialized smallipop"+r).data({id:r,options:t,hint:o}).attr("title","").bind(s);return e("a",this).live("click",i.hideSmallipop)}})}})(jQuery);