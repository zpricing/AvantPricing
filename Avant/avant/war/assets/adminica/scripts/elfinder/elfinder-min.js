(function(e){elFinder=function(t,n){function s(e,t){e&&r.view.win.width(e);t&&r.view.nav.add(r.view.cwd).height(t)}function o(){s(null,r.dialog.height()-r.view.tlb.parent().height()-(e.browser.msie?47:32))}var r=this,i;this.log=function(e){window.console&&window.console.log&&window.console.log(e)};this.options=e.extend({},this.options,n||{});if(!this.options.url){alert("Invalid configuration! You have to set URL option.");return}this.id="";if(i=e(t).attr("id"))this.id=i;this.version="1.2";this.jquery=e.fn.jquery.split(".").join("");this.cwd={};this.cdc={};this.buffer={};this.selected=[];this.history=[];this.locked=!1;this.zIndex=2;this.dialog=null;this.anchor=this.options.docked?e("<div/>").hide().insertBefore(t):null;this.params={dotFiles:!1,arc:"",uplMaxSize:""};this.vCookie="el-finder-view-"+this.id;this.pCookie="el-finder-places-"+this.id;this.lCookie="el-finder-last-"+this.id;this.view=new this.view(this,t);this.ui=new this.ui(this);this.eventsManager=new this.eventsManager(this);this.quickLook=new this.quickLook(this);this.cookie=function(t,n){if(typeof n=="undefined"){if(document.cookie&&document.cookie!=""){var r,i=document.cookie.split(";");t+="=";for(r=0;r<i.length;r++){i[r]=e.trim(i[r]);if(i[r].substring(0,t.length)==t)return decodeURIComponent(i[r].substring(t.length))}}return""}var s,o=e.extend({},this.options.cookie);if(n===null){n="";o.expires=-1}if(typeof o.expires=="number"){s=new Date;s.setTime(s.getTime()+o.expires*24*60*60*1e3);o.expires=s}document.cookie=t+"="+encodeURIComponent(n)+"; expires="+o.expires.toUTCString()+(o.path?"; path="+o.path:"")+(o.domain?"; domain="+o.domain:"")+(o.secure?"; secure":"")};this.lock=function(e){this.view.spinner(this.locked=e||!1);this.eventsManager.lock=this.locked};this.lockShortcuts=function(e){this.eventsManager.lock=!!e};this.setView=function(e){if(e=="list"||e=="icons"){this.options.view=e;this.cookie(this.vCookie,e)}};this.ajax=function(t,n,i){var s={url:this.options.url,async:!0,type:"GET",data:t,dataType:"json",cache:!1,lock:!0,force:!1,silent:!1};typeof i=="object"&&(s=e.extend({},s,i));s.silent||(s.error=r.view.fatal);s.success=function(e){s.lock&&r.lock();if(e){e.debug&&r.log(e.debug);if(e.error){!s.silent&&r.view.error(e.error,e.errorData);if(!s.force)return}n(e);delete e}};s.lock&&this.lock(!0);e.ajax(s)};this.tmb=function(){this.ajax({cmd:"tmb",current:r.cwd.hash},function(t){if(r.options.view=="icons"&&t.images&&t.current==r.cwd.hash){for(var n in t.images)if(r.cdc[n]){r.cdc[n].tmb=t.images[n];e('div[key="'+n+'"]>p',r.view.cwd).css("background",' url("'+t.images[n]+'") 0 0 no-repeat')}t.tmb&&r.tmb()}},{lock:!1,silent:!0})};this.getPlaces=function(){var e=[],t=this.cookie(this.pCookie);t.length&&(t.indexOf(":")!=-1?e=t.split(":"):e.push(t));return e};this.addPlace=function(t){var n=this.getPlaces();if(e.inArray(t,n)==-1){n.push(t);this.savePlaces(n);return!0}};this.removePlace=function(t){var n=this.getPlaces();if(e.inArray(t,n)!=-1){this.savePlaces(e.map(n,function(e){return e==t?null:e}));return!0}};this.savePlaces=function(e){this.cookie(this.pCookie,e.join(":"))};this.reload=function(e){var t;this.cwd=e.cwd;this.cdc={};for(t=0;t<e.cdc.length;t++)if(e.cdc[t].hash&&e.cdc[t].name){this.cdc[e.cdc[t].hash]=e.cdc[t];this.cwd.size+=e.cdc[t].size}if(e.tree){this.view.renderNav(e.tree);this.eventsManager.updateNav()}this.updateCwd();e.tmb&&!r.locked&&r.options.view=="icons"&&r.tmb();if(e.select&&e.select.length){var n=e.select.length;while(n--)this.cdc[e.select[n]]&&this.selectById(e.select[n])}this.lastDir(this.cwd.hash);if(this.options.autoReload>0){this.iID&&clearInterval(this.iID);this.iID=setInterval(function(){!r.locked&&r.ui.exec("reload")},this.options.autoReload*6e4)}};this.updateCwd=function(){this.lockShortcuts(!0);this.selected=[];this.view.renderCwd();this.eventsManager.updateCwd();this.view.tree.find('a[key="'+this.cwd.hash+'"]').trigger("select");this.lockShortcuts()};this.drop=function(t,n,i){if(n.helper.find('[key="'+i+'"]').length)return r.view.error("Unable to copy into itself");var s=[];n.helper.find('div:not(.noaccess):has(>label):not(:has(em[class="readonly"],em[class=""]))').each(function(){s.push(e(this).hide().attr("key"))});n.helper.find("div:has(>label):visible").length||n.helper.hide();if(s.length){r.setBuffer(s,t.shiftKey?0:1,i);r.buffer.files&&setTimeout(function(){r.ui.exec("paste");r.buffer={}},300)}else e(this).removeClass("el-finder-droppable")};this.getSelected=function(e){var t,n=[];if(e>=0)return this.cdc[this.selected[e]]||{};for(t=0;t<this.selected.length;t++)this.cdc[this.selected[t]]&&n.push(this.cdc[this.selected[t]]);return n};this.select=function(t,n){n&&e(".ui-selected",r.view.cwd).removeClass("ui-selected");t.addClass("ui-selected");r.updateSelect()};this.selectById=function(t){var n=e('[key="'+t+'"]',this.view.cwd);if(n.length){this.select(n);this.checkSelectedPos()}};this.unselect=function(e){e.removeClass("ui-selected");r.updateSelect()};this.toggleSelect=function(e){e.toggleClass("ui-selected");this.updateSelect()};this.selectAll=function(){e("[key]",r.view.cwd).addClass("ui-selected");r.updateSelect()};this.unselectAll=function(){e(".ui-selected",r.view.cwd).removeClass("ui-selected");r.updateSelect()};this.updateSelect=function(){r.selected=[];e(".ui-selected",r.view.cwd).each(function(){r.selected.push(e(this).attr("key"))});r.view.selectedInfo();r.ui.update();r.quickLook.update()};this.checkSelectedPos=function(e){var t=r.view.cwd.find(".ui-selected:"+(e?"last":"first")).eq(0),n=t.position(),i=t.outerHeight(),s=r.view.cwd.height();n.top<0?r.view.cwd.scrollTop(n.top+r.view.cwd.scrollTop()-2):s-n.top<i&&r.view.cwd.scrollTop(n.top+i-s+r.view.cwd.scrollTop())};this.setBuffer=function(e,t,n){var r,i,s;this.buffer={src:this.cwd.hash,dst:n,files:[],names:[],cut:t||0};for(r=0;r<e.length;r++){i=e[r];s=this.cdc[i];if(s&&s.read&&s.type!="link"){this.buffer.files.push(s.hash);this.buffer.names.push(s.name)}}this.buffer.files.length||(this.buffer={})};this.isValidName=function(e){return!this.cwd.dotFiles&&e.indexOf(".")==0?!1:e.match(/^[^\\\/\<\>:]+$/)};this.fileExists=function(e){for(var t in this.cdc)if(this.cdc[t].name==e)return t;return!1};this.uniqueName=function(e,t){e=r.i18n(e);var n=e,i=0,t=t||"";if(!this.fileExists(n+t))return n+t;while(i++<100)if(!this.fileExists(n+i+t))return n+i+t;return n.replace("100","")+Math.random()+t};this.lastDir=function(e){if(this.options.rememberLastDir)return e?this.cookie(this.lCookie,e):this.cookie(this.lCookie)};this.time=function(){return(new Date).getMilliseconds()};this.setView(this.cookie(this.vCookie));s(r.options.width,r.options.height);if(this.options.dialog||this.options.docked){this.options.dialog=e.extend({width:570,dialogClass:"",minWidth:480,minHeight:330},this.options.dialog||{});this.options.dialog.open=function(){setTimeout(function(){e('<input type="text" value="f"/>').appendTo(r.view.win).focus().select().remove()},200)};this.options.dialog.dialogClass+="el-finder-dialog";this.options.dialog.resize=o;if(this.options.docked){this.options.dialog.close=function(){r.dock()};this.view.win.data("size",{width:this.view.win.width(),height:this.view.nav.height()})}else{this.options.dialog.close=function(){r.destroy()};this.dialog=e("<div/>").append(this.view.win).dialog(this.options.dialog)}}this.ajax({cmd:"open",target:this.lastDir()||"",init:!0,tree:!0},function(t){if(t.cwd){r.eventsManager.init();r.reload(t);e.extend(r.params,t.params||{});e("*",document.body).each(function(){var t=parseInt(e(this).css("z-index"));t>=r.zIndex&&(r.zIndex=t+1)});r.ui.init(t.disabled)}},{force:!0});this.open=function(){this.dialog?this.dialog.dialog("open"):this.view.win.show();this.eventsManager.lock=!1};this.close=function(){this.quickLook.hide();this.options.docked&&this.view.win.attr("undocked")?this.dock():this.dialog?this.dialog.dialog("close"):this.view.win.hide();this.eventsManager.lock=!0};this.destroy=function(){this.eventsManager.lock=!0;this.quickLook.hide();this.quickLook.win.remove();if(this.dialog){this.dialog.dialog("destroy");this.view.win.parent().remove()}else this.view.win.remove();this.ui.menu.remove()};this.dock=function(){if(this.options.docked&&this.view.win.attr("undocked")){this.quickLook.hide();var e=this.view.win.data("size");this.view.win.insertAfter(this.anchor).removeAttr("undocked");s(e.width,e.height);this.dialog.dialog("destroy");this.dialog=null}};this.undock=function(){if(this.options.docked&&!this.view.win.attr("undocked")){this.quickLook.hide();this.dialog=e("<div/>").append(this.view.win.css("width","100%").attr("undocked",!0).show()).dialog(this.options.dialog);o()}}};elFinder.prototype.i18n=function(e){return this.options.i18n[this.options.lang]&&this.options.i18n[this.options.lang][e]?this.options.i18n[this.options.lang][e]:e};elFinder.prototype.options={url:"",lang:"en",cssClass:"",wrap:14,places:"Places",placesFirst:!0,editorCallback:null,cutURL:"",closeOnEditorCallback:!0,i18n:{},view:"icons",width:"",height:"",disableShortcuts:!1,rememberLastDir:!0,cookie:{expires:30,domain:"",path:"/",secure:!1},toolbar:[["back","reload"],["select","open"],["mkdir","mkfile","upload"],["copy","paste","rm"],["rename","edit"],["info","quicklook","resize"],["icons","list"],["help"]],contextmenu:{cwd:["reload","delim","mkdir","mkfile","upload","delim","paste","delim","info"],file:["select","open","quicklook","delim","copy","cut","rm","delim","duplicate","rename","edit","resize","archive","extract","delim","info"],group:["select","copy","cut","rm","delim","archive","extract","delim","info"]},dialog:null,docked:!1,autoReload:0,selectMultiple:!1};e.fn.elfinder=function(e){return this.each(function(){var t=typeof e=="string"?e:"";this.elfinder||(this.elfinder=new elFinder(this,typeof e=="object"?e:{}));switch(t){case"close":case"hide":this.elfinder.close();break;case"open":case"show":this.elfinder.open();break;case"dock":this.elfinder.dock();break;case"undock":this.elfinder.undock();break;case"destroy":this.elfinder.destroy()}})}})(jQuery);(function(e){elFinder.prototype.view=function(t,n){var r=this;this.fm=t;this.kinds={unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"Broken alias","application/x-empty":"Plain text","application/postscript":"Postscript document","application/octet-stream":"Application","application/vnd.ms-office":"Microsoft Office document","application/vnd.ms-word":"Microsoft Word document","application/vnd.ms-excel":"Microsoft Excel document","application/vnd.ms-powerpoint":"Microsoft Powerpoint presentation","application/pdf":"Portable Document Format (PDF)","application/vnd.oasis.opendocument.text":"Open Office document","application/x-shockwave-flash":"Flash application","application/xml":"XML document","application/x-bittorrent":"Bittorrent file","application/x-7z-compressed":"7z archive","application/x-tar":"TAR archive","application/x-gzip":"GZIP archive","application/x-bzip2":"BZIP archive","application/zip":"ZIP archive","application/x-rar":"RAR archive","application/javascript":"Javascript application","text/plain":"Plain text","text/x-php":"PHP source","text/html":"HTML document","text/javascript":"Javascript source","text/css":"CSS style sheet","text/rtf":"Rich Text Format (RTF)","text/rtfd":"RTF with attachments (RTFD)","text/x-c":"C source","text/x-c++":"C++ source","text/x-shellscript":"Unix shell script","text/x-python":"Python source","text/x-java":"Java source","text/x-ruby":"Ruby source","text/x-perl":"Perl script","text/xml":"XML document","image/x-ms-bmp":"BMP image","image/jpeg":"JPEG image","image/gif":"GIF Image","image/png":"PNG image","image/x-targa":"TGA image","image/tiff":"TIFF image","image/vnd.adobe.photoshop":"Adobe Photoshop image","audio/mpeg":"MPEG audio","audio/midi":"MIDI audio","audio/ogg":"Ogg Vorbis audio","audio/mp4":"MP4 audio","audio/wav":"WAV audio","video/x-dv":"DV video","video/mp4":"MP4 video","video/mpeg":"MPEG video","video/x-msvideo":"AVI video","video/quicktime":"Quicktime video","video/x-ms-wmv":"WM video","video/x-flv":"Flash video","video/x-matroska":"Matroska video"};this.tlb=e("<ul />");this.nav=e('<div class="el-finder-nav"/>').resizable({handles:"e",autoHide:!0,minWidth:200,maxWidth:500});this.cwd=e('<div class="el-finder-cwd"/>').attr("unselectable","on");this.spn=e('<div class="el-finder-spinner"/>');this.err=e('<p class="el-finder-err"><strong/></p>').click(function(){e(this).hide()});this.nfo=e('<div class="el-finder-stat"/>');this.pth=e('<div class="el-finder-path"/>');this.sel=e('<div class="el-finder-sel"/>');this.stb=e('<div class="el-finder-statusbar"/>').append(this.pth).append(this.nfo).append(this.sel);this.wrz=e('<div class="el-finder-workzone" />').append(this.nav).append(this.cwd).append(this.spn).append(this.err).append('<div style="clear:both" />');this.win=e(n).empty().attr("id",this.fm.id).addClass("el-finder "+(t.options.cssClass||"")).append(e('<div class="el-finder-toolbar" />').append(this.tlb)).append(this.wrz).append(this.stb);this.tree=e('<ul class="el-finder-tree"></ul>').appendTo(this.nav);this.plc=e('<ul class="el-finder-places"><li><a href="#" class="el-finder-places-root"><div/>'+this.fm.i18n(this.fm.options.places)+"</a><ul/></li></ul>").hide();this.nav[this.fm.options.placesFirst?"prepend":"append"](this.plc);this.spinner=function(e){this.win.toggleClass("el-finder-disabled",e);this.spn.toggle(e)};this.fatal=function(e){r.error(e.status!="404"?"Invalid backend configuration":"Unable to connect to backend")};this.error=function(e,t){this.fm.lock();this.err.show().children("strong").html(this.fm.i18n(e)+"!"+this.formatErrorData(t));setTimeout(function(){r.err.fadeOut("slow")},4e3)};this.renderNav=function(e){function r(e){var t,n,i,s='<ul style="display:none">';for(t=0;t<e.length;t++){if(!e[t].name||!e[t].hash)continue;i="";!e[t].read&&!e[t].write?i="noaccess":e[t].read?e[t].write||(i="readonly"):i="dropbox";s+='<li><a href="#" class="'+i+'" key="'+e[t].hash+'"><div'+(e[t].dirs.length?' class="collapsed"':"")+"/>"+e[t].name+"</a>";e[t].dirs.length&&(s+=r(e[t].dirs));s+="</li>"}return s+"</ul>"}var t=e.dirs.length?r(e.dirs):"",n='<li><a href="#" class="el-finder-tree-root" key="'+e.hash+'"><div'+(t?' class="collapsed expanded"':"")+"/>"+e.name+"</a>"+t+"</li>";this.tree.html(n);this.fm.options.places&&this.renderPlaces()};this.renderPlaces=function(){var t,n,i=this.fm.getPlaces(),s=this.plc.show().find("ul").empty().hide();e("div:first",this.plc).removeClass("collapsed expanded");if(i.length){i.sort(function(e,t){var n=r.tree.find('a[key="'+e+'"]').text()||"",i=r.tree.find('a[key="'+t+'"]').text()||"";return n.localeCompare(i)});for(t=0;t<i.length;t++)(n=this.tree.find('a[key="'+i[t]+'"]:not(.dropbox)').parent())&&n.length?s.append(n.clone().children("ul").remove().end().find("div").removeClass("collapsed expanded").end()):this.fm.removePlace(i[t]);s.children().length&&e("div:first",this.plc).addClass("collapsed")}};this.renderCwd=function(){this.cwd.empty();var e=0,n=0,r="";for(var i in this.fm.cdc){e++;n+=this.fm.cdc[i].size;r+=this.fm.options.view=="icons"?this.renderIcon(this.fm.cdc[i]):this.renderRow(this.fm.cdc[i],e%2)}this.fm.options.view=="icons"?this.cwd.append(r):this.cwd.append('<table><tr><th colspan="2">'+this.fm.i18n("Name")+"</th><th>"+this.fm.i18n("Permissions")+"</th><th>"+this.fm.i18n("Modified")+'</th><th class="size">'+this.fm.i18n("Size")+"</th><th>"+this.fm.i18n("Kind")+"</th></tr>"+r+"</table>");this.pth.text(t.cwd.rel);this.nfo.text(t.i18n("items")+": "+e+", "+this.formatSize(n));this.sel.empty()};this.renderIcon=function(e){var t="<p"+(e.tmb?" style=\"background:url('"+e.tmb+"') 0 0 no-repeat"+'"':"")+"/><label>"+this.formatName(e.name)+"</label>";if(e.link||e.mime=="symlink-broken")t+="<em/>";!e.read&&!e.write?t+='<em class="noaccess"/>':e.read&&!e.write?t+='<em class="readonly"/>':!e.read&&e.write&&(t+='<em class="'+(e.mime=="directory"?"dropbox":"noread")+'" />');return'<div class="'+this.mime2class(e.mime)+'" key="'+e.hash+'">'+t+"</div>"};this.renderRow=function(e,t){var n=e.link||e.mime=="symlink-broken"?"<em/>":"";!e.read&&!e.write?n+='<em class="noaccess"/>':e.read&&!e.write?n+='<em class="readonly"/>':!e.read&&e.write&&(n+='<em class="'+(e.mime=="directory"?"dropbox":"noread")+'" />');return'<tr key="'+e.hash+'" class="'+r.mime2class(e.mime)+(t?" el-finder-row-odd":"")+'"><td class="icon"><p>'+n+"</p></td><td>"+e.name+"</td><td>"+r.formatPermissions(e.read,e.write,e.rm)+"</td><td>"+r.formatDate(e.date)+'</td><td class="size">'+r.formatSize(e.size)+"</td><td>"+r.mime2kind(e.link?"symlink":e.mime)+"</td></tr>"};this.updateFile=function(e){var t=this.cwd.find('[key="'+e.hash+'"]');t.replaceWith(t[0].nodeName=="DIV"?this.renderIcon(e):this.renderRow(e))};this.selectedInfo=function(){var e,t=0,n;if(r.fm.selected.length){n=this.fm.getSelected();for(e=0;e<n.length;e++)t+=n[e].size}this.sel.text(e>0?this.fm.i18n("selected items")+": "+n.length+", "+this.formatSize(t):"")};this.formatName=function(e){var t=r.fm.options.wrap;if(t>0){if(e.length>t*2)return e.substr(0,t)+"&shy;"+e.substr(t,t-5)+"&hellip;"+e.substr(e.length-3);if(e.length>t)return e.substr(0,t)+"&shy;"+e.substr(t)}return e};this.formatErrorData=function(e){var t,n="";if(typeof e=="object"){n="<br />";for(t in e)n+=t+" "+r.fm.i18n(e[t])+"<br />"}return n};this.mime2class=function(e){return e.replace("/"," ").replace(/\./g,"-")};this.formatDate=function(e){return e.replace(/([a-z]+)\s/i,function(e,t){return r.fm.i18n(t)+" "})};this.formatSize=function(e){var t=1,n="bytes";if(e>1073741824){t=1073741824;n="Gb"}else if(e>1048576){t=1048576;n="Mb"}else if(e>1024){t=1024;n="Kb"}return Math.round(e/t)+" "+n};this.formatPermissions=function(e,t,n){var i=[];e&&i.push(r.fm.i18n("read"));t&&i.push(r.fm.i18n("write"));n&&i.push(r.fm.i18n("remove"));return i.join("/")};this.mime2kind=function(e){return this.fm.i18n(this.kinds[e]||"unknown")}}})(jQuery);(function(e){elFinder.prototype.ui=function(t){var n=this;this.fm=t;this.cmd={};this.buttons={};this.menu=e('<div class="el-finder-contextmenu" />').appendTo(document.body).hide();this.dockButton=e('<div class="el-finder-dock-button" title="'+n.fm.i18n("Dock/undock filemanager window")+'" />');this.exec=function(t,n){if(this.cmd[t]){if(t!="open"&&!this.cmd[t].isAllowed())return this.fm.view.error("Command not allowed");if(!this.fm.locked){this.fm.quickLook.hide();e(".el-finder-info").remove();this.cmd[t].exec(n);this.update()}}};this.cmdName=function(e){return this.cmd[e]&&this.cmd[e].name?e=="archive"&&this.fm.params.archives.length==1?this.fm.i18n("Create")+" "+this.fm.view.mime2kind(this.fm.params.archives[0]).toLowerCase():this.fm.i18n(this.cmd[e].name):e};this.isCmdAllowed=function(e){return n.cmd[e]&&n.cmd[e].isAllowed()};this.execIfAllowed=function(e){this.isCmdAllowed(e)&&this.exec(e)};this.includeInCm=function(e,t){return this.isCmdAllowed(e)&&this.cmd[e].cm(t)};this.showMenu=function(t){function u(e){var t,r,i,s,o,u=n.fm.options.contextmenu[e]||[];for(t=0;t<u.length;t++)if(u[t]=="delim")n.menu.children().length&&!n.menu.children(":last").hasClass("delim")&&n.menu.append('<div class="delim" />');else if(n.fm.ui.includeInCm(u[t],e)){i=n.cmd[u[t]].argc();s="";if(i.length){s='<span/><div class="el-finder-contextmenu-sub" style="z-index:'+(parseInt(n.menu.css("z-index"))+1)+'">';for(var r=0;r<i.length;r++)s+='<div name="'+u[t]+'" argc="'+i[r].argc+'" class="'+i[r]["class"]+'">'+i[r].text+"</div>";s+="</div>"}n.menu.append('<div class="'+u[t]+'" name="'+u[t]+'">'+s+n.cmdName(u[t])+"</div>")}}var r,i,s,o="";this.hideMenu();n.fm.selected.length?n.fm.selected.length==1?r="file":r="group":r="cwd";u(r);i=e(window);s={height:i.height(),width:i.width(),sT:i.scrollTop(),cW:this.menu.width(),cH:this.menu.height()};this.menu.css({left:t.clientX+s.cW>s.width?t.clientX-s.cW:t.clientX,top:t.clientY+s.cH>s.height&&t.clientY>s.cH?t.clientY+s.sT-s.cH:t.clientY+s.sT}).show().find("div[name]").hover(function(){var t=e(this),n=t.children("div"),r;t.addClass("hover");if(n.length){if(!n.attr("pos")){r=t.outerWidth();n.css(e(window).width()-r-t.offset().left>n.width()?"left":"right",r-5).attr("pos",!0)}n.show()}},function(){e(this).removeClass("hover").children("div").hide()}).click(function(t){t.stopPropagation();var r=e(this);if(!r.children("div").length){n.hideMenu();n.exec(r.attr("name"),r.attr("argc"))}})};this.hideMenu=function(){this.menu.hide().empty()};this.update=function(){for(var e in this.buttons)this.buttons[e].toggleClass("disabled",!this.cmd[e].isAllowed())};this.init=function(t){var r,i,s,o=!1,u=2,a,f=this.fm.options.toolbar;this.fm.options.editorCallback||t.push("select");!this.fm.params.archives.length&&e.inArray("archive",t)==-1&&t.push("archive");for(r in this.commands)if(e.inArray(r,t)==-1){this.commands[r].prototype=this.command.prototype;this.cmd[r]=new this.commands[r](this.fm)}for(r=0;r<f.length;r++){o&&this.fm.view.tlb.append('<li class="delim" />');o=!1;for(i=0;i<f[r].length;i++){s=f[r][i];if(this.cmd[s]){o=!0;this.buttons[s]=e('<li class="'+s+'" title="'+this.cmdName(s)+'" name="'+s+'" />').appendTo(this.fm.view.tlb).click(function(e){e.stopPropagation()}).bind("click",function(t){return function(){!e(this).hasClass("disabled")&&t.exec(e(this).attr("name"))}}(this)).hover(function(){!e(this).hasClass("disabled")&&e(this).addClass("el-finder-tb-hover")},function(){e(this).removeClass("el-finder-tb-hover")})}}}this.update();this.menu.css("z-index",this.fm.zIndex);this.fm.options.docked&&this.dockButton.hover(function(){e(this).addClass("el-finder-dock-button-hover")},function(){e(this).removeClass("el-finder-dock-button-hover")}).click(function(){n.fm.view.win.attr("undocked")?n.fm.dock():n.fm.undock();e(this).trigger("mouseout")}).prependTo(this.fm.view.tlb)}};elFinder.prototype.ui.prototype.command=function(e){};elFinder.prototype.ui.prototype.command.prototype.isAllowed=function(){return!0};elFinder.prototype.ui.prototype.command.prototype.cm=function(e){return!1};elFinder.prototype.ui.prototype.command.prototype.argc=function(e){return[]};elFinder.prototype.ui.prototype.commands={back:function(e){var t=this;this.name="Back";this.fm=e;this.exec=function(){this.fm.history.length&&this.fm.ajax({cmd:"open",target:this.fm.history.pop()},function(e){t.fm.reload(e)})};this.isAllowed=function(){return this.fm.history.length}},reload:function(e){var t=this;this.name="Reload";this.fm=e;this.exec=function(){this.fm.ajax({cmd:"open",target:this.fm.cwd.hash,tree:!0},function(e){t.fm.reload(e)})};this.cm=function(e){return e=="cwd"}},open:function(t){var n=this;this.name="Open";this.fm=t;this.exec=function(t){function i(e){n.fm.history.push(n.fm.cwd.hash);n.fm.ajax({cmd:"open",target:e},function(e){n.fm.reload(e)})}function s(e){var t,r="";if(e.dim){t=e.dim.split("x");r="width="+(parseInt(t[0])+20)+",height="+(parseInt(t[1])+20)+","}window.open(e.url||n.fm.options.url+"?cmd=open&current="+(e.parent||n.fm.cwd.hash)+"&target="+(e.link||e.hash),!1,"top=50,left=50,"+r+"scrollbars=yes,resizable=yes")}var r=null;t?r={hash:e(t).attr("key"),mime:"directory",read:!e(t).hasClass("noaccess")&&!e(t).hasClass("dropbox")}:r=this.fm.getSelected(0);if(!r.hash)return;if(!r.read)return this.fm.view.error("Access denied");if(r.type=="link"&&!r.link)return this.fm.view.error("Unable to open broken link");r.mime=="directory"?i(r.link||r.hash):s(r)};this.isAllowed=function(){return this.fm.selected.length==1&&this.fm.getSelected(0).read};this.cm=function(e){return e=="file"}},select:function(t){this.name="Select file";this.fm=t;t.options.selectMultiple?this.exec=function(){var n=e(t.getSelected()).map(function(){return t.options.cutURL=="root"?this.url.substr(t.params.url.length):this.url.replace(new RegExp("^("+t.options.cutURL+")"),"")});t.options.editorCallback(n);if(t.options.closeOnEditorCallback){t.dock();t.close()}}:this.exec=function(){var e=this.fm.getSelected(0);if(!e.url)return this.fm.view.error("File URL disabled by connector config");this.fm.options.editorCallback(this.fm.options.cutURL=="root"?e.url.substr(this.fm.params.url.length):e.url.replace(new RegExp("^("+this.fm.options.cutURL+")"),""));if(this.fm.options.closeOnEditorCallback){this.fm.dock();this.fm.close();this.fm.destroy()}};this.isAllowed=function(){return(this.fm.options.selectMultiple&&this.fm.selected.length>=1||this.fm.selected.length==1)&&!/(symlink\-broken|directory)/.test(this.fm.getSelected(0).mime)};this.cm=function(e){return e!="cwd"}},quicklook:function(e){var t=this;this.name="Preview with Quick Look";this.fm=e;this.exec=function(){t.fm.quickLook.toggle()};this.isAllowed=function(){return this.fm.selected.length==1};this.cm=function(){return!0}},info:function(t){var n=this;this.name="Get info";this.fm=t;this.exec=function(){function u(t){var r=["50%","50%"],u,a,f,l='<table cellspacing="0"><tr><td>'+n.fm.i18n("Name")+"</td><td>"+t.name+"</td></tr><tr><td>"+n.fm.i18n("Kind")+"</td><td>"+n.fm.view.mime2kind(t.link?"symlink":t.mime)+"</td></tr><tr><td>"+n.fm.i18n("Size")+"</td><td>"+n.fm.view.formatSize(t.size)+"</td></tr><tr><td>"+n.fm.i18n("Modified")+"</td><td>"+n.fm.view.formatDate(t.date)+"</td></tr><tr><td>"+n.fm.i18n("Permissions")+"</td><td>"+n.fm.view.formatPermissions(t.read,t.write,t.rm)+"</td></tr>";t.link&&(l+="<tr><td>"+n.fm.i18n("Link to")+"</td><td>"+t.linkTo+"</td></tr>");t.dim&&(l+="<tr><td>"+n.fm.i18n("Dimensions")+"</td><td>"+t.dim+" px.</td></tr>");t.url&&(l+="<tr><td>"+n.fm.i18n("URL")+'</td><td><a href="'+t.url+'" target="_blank">'+t.url+"</a></td></tr>");if(i>1){f=e(".el-finder-dialog-info:last");if(!f.length){u=Math.round((s-350)/2-i*10);a=Math.round((o-300)/2-i*10);r=[u>20?u:20,a>20?a:20]}else{u=f.offset().left+10;a=f.offset().top+10;r=[u<s-350?u:20,a<o-300?a:20]}}e("<div />").append(l+"</table>").dialog({dialogClass:"el-finder-dialog el-finder-dialog-info",width:390,position:r,title:n.fm.i18n(t.mime=="directory"?"Folder info":"File info"),close:function(){--i<=0&&n.fm.lockShortcuts();e(this).dialog("destroy")},buttons:{Ok:function(){e(this).dialog("close")}}})}var t,r,i=this.fm.selected.length,s=e(window).width(),o=e(window).height();this.fm.lockShortcuts(!0);i?e.each(this.fm.getSelected(),function(){u(this)}):u(n.fm.cwd)};this.cm=function(e){return!0}},rename:function(t){var n=this;this.name="Rename";this.fm=t;this.exec=function(){function a(){i.html(u);n.fm.lockShortcuts()}function f(){if(!n.fm.locked){var e,t=s.val();if(o.name==s.val())return a();n.fm.isValidName(t)?n.fm.fileExists(t)&&(e="File or folder with the same name already exists"):e="Invalid name";if(e){n.fm.view.error(e);r.addClass("ui-selected");n.fm.lockShortcuts(!0);return s.select().focus()}n.fm.ajax({cmd:"rename",current:n.fm.cwd.hash,target:o.hash,name:t},function(e){if(e.error)a();else{o.mime=="directory"&&n.fm.removePlace(o.hash)&&n.fm.addPlace(e.target);n.fm.reload(e)}},{force:!0})}}var t=this.fm.getSelected(),r,i,s,o,u;if(t.length==1){o=t[0];r=this.fm.view.cwd.find('[key="'+o.hash+'"]');i=this.fm.options.view=="icons"?r.children("label"):r.find("td").eq(1);u=i.html();s=e('<input type="text" />').val(o.name).appendTo(i.empty()).bind("change blur",f).keydown(function(t){t.stopPropagation();t.keyCode==27?a():t.keyCode==13&&(o.name==s.val()?a():e(this).trigger("change"))}).click(function(e){e.stopPropagation()}).select().focus();this.fm.lockShortcuts(!0)}};this.isAllowed=function(){return this.fm.cwd.write&&this.fm.getSelected(0).write};this.cm=function(e){return e=="file"}},copy:function(e){this.name="Copy";this.fm=e;this.exec=function(){this.fm.setBuffer(this.fm.selected)};this.isAllowed=function(){if(this.fm.selected.length){var e=this.fm.getSelected(),t=e.length;while(t--)if(e[t].read)return!0}return!1};this.cm=function(e){return e!="cwd"}},cut:function(e){this.name="Cut";this.fm=e;this.exec=function(){this.fm.setBuffer(this.fm.selected,1)};this.isAllowed=function(){if(this.fm.selected.length){var e=this.fm.getSelected(),t=e.length;while(t--)if(e[t].read&&e[t].rm)return!0}return!1};this.cm=function(e){return e!="cwd"}},paste:function(e){var t=this;this.name="Paste";this.fm=e;this.exec=function(){var e,n,r,i,s="";this.fm.buffer.dst||(this.fm.buffer.dst=this.fm.cwd.hash);n=this.fm.view.tree.find('[key="'+this.fm.buffer.dst+'"]');if(!n.length||n.hasClass("noaccess")||n.hasClass("readonly"))return this.fm.view.error("Access denied");if(this.fm.buffer.src==this.fm.buffer.dst)return this.fm.view.error("Unable to copy into itself");var o={cmd:"paste",current:this.fm.cwd.hash,src:this.fm.buffer.src,dst:this.fm.buffer.dst,cut:this.fm.buffer.cut};this.fm.jquery>132?o.targets=this.fm.buffer.files:o["targets[]"]=this.fm.buffer.files;this.fm.ajax(o,function(e){e.cdc&&t.fm.reload(e)},{force:!0})};this.isAllowed=function(){return this.fm.buffer.files};this.cm=function(e){return e=="cwd"}},rm:function(t){var n=this;this.name="Remove";this.fm=t;this.exec=function(){var t,r=[],i=this.fm.getSelected();for(var t=0;t<i.length;t++){if(!i[t].rm)return this.fm.view.error(i[t].name+": "+this.fm.i18n("Access denied"));r.push(i[t].hash)}if(r.length){this.fm.lockShortcuts(!0);e('<div><div class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert"/><strong>'+this.fm.i18n("Are you sure you want to remove files?<br /> This cannot be undone!")+"</strong></div></div>").dialog({title:this.fm.i18n("Confirmation required"),dialogClass:"el-finder-dialog",width:350,close:function(){n.fm.lockShortcuts()},buttons:{Cancel:function(){e(this).dialog("close")},Ok:function(){e(this).dialog("close");var t={cmd:"rm",current:n.fm.cwd.hash};n.fm.jquery>132?t.targets=r:t["targets[]"]=r;n.fm.ajax(t,function(e){e.tree&&n.fm.reload(e)},{force:!0})}}})}};this.isAllowed=function(e){if(this.fm.selected.length){var t=this.fm.getSelected(),n=t.length;while(n--)if(t[n].rm)return!0}return!1};this.cm=function(e){return e!="cwd"}},mkdir:function(t){var n=this;this.name="New folder";this.fm=t;this.exec=function(){function r(){if(!n.fm.locked){var e,t=input.val();n.fm.isValidName(t)?n.fm.fileExists(t)&&(e="File or folder with the same name already exists"):e="Invalid name";if(e){n.fm.view.error(e);n.fm.lockShortcuts(!0);el.addClass("ui-selected");return input.select().focus()}n.fm.ajax({cmd:"mkdir",current:n.fm.cwd.hash,name:t},function(e){if(e.error){el.addClass("ui-selected");return input.select().focus()}n.fm.reload(e)},{force:!0})}}n.fm.unselectAll();var t=this.fm.uniqueName("untitled folder");input=e('<input type="text"/>').val(t);prev=this.fm.view.cwd.find(".directory:last");f={name:t,hash:"",mime:"directory",read:!0,write:!0,date:"",size:0},el=this.fm.options.view=="list"?e(this.fm.view.renderRow(f)).children("td").eq(1).empty().append(input).end().end():e(this.fm.view.renderIcon(f)).children("label").empty().append(input).end();el.addClass("directory ui-selected");prev.length?el.insertAfter(prev):this.fm.options.view=="list"?el.insertAfter(this.fm.view.cwd.find("tr").eq(0)):el.prependTo(this.fm.view.cwd);n.fm.checkSelectedPos();input.select().focus().click(function(e){e.stopPropagation()}).bind("change blur",r).keydown(function(e){e.stopPropagation();if(e.keyCode==27){el.remove();n.fm.lockShortcuts()}else e.keyCode==13&&r()});n.fm.lockShortcuts(!0)};this.isAllowed=function(){return this.fm.cwd.write};this.cm=function(e){return e=="cwd"}},mkfile:function(t){var n=this;this.name="New text file";this.fm=t;this.exec=function(){function o(){if(!n.fm.locked){var e,t=r.val();n.fm.isValidName(t)?n.fm.fileExists(t)&&(e="File or folder with the same name already exists"):e="Invalid name";if(e){n.fm.view.error(e);n.fm.lockShortcuts(!0);s.addClass("ui-selected");return r.select().focus()}n.fm.ajax({cmd:"mkfile",current:n.fm.cwd.hash,name:t},function(e){if(e.error){s.addClass("ui-selected");return r.select().focus()}n.fm.reload(e)},{force:!0})}}n.fm.unselectAll();var t=this.fm.uniqueName("untitled file",".txt"),r=e('<input type="text"/>').val(t),i={name:t,hash:"",mime:"text/plain",read:!0,write:!0,date:"",size:0},s=this.fm.options.view=="list"?e(this.fm.view.renderRow(i)).children("td").eq(1).empty().append(r).end().end():e(this.fm.view.renderIcon(i)).children("label").empty().append(r).end();s.addClass("text ui-selected").appendTo(this.fm.options.view=="list"?n.fm.view.cwd.children("table"):n.fm.view.cwd);r.select().focus().bind("change blur",o).click(function(e){e.stopPropagation()}).keydown(function(e){e.stopPropagation();if(e.keyCode==27){s.remove();n.fm.lockShortcuts()}else e.keyCode==13&&o()});n.fm.lockShortcuts(!0)};this.isAllowed=function(e){return this.fm.cwd.write};this.cm=function(e){return e=="cwd"}},upload:function(t){var n=this;this.name="Upload files";this.fm=t;this.exec=function(){function c(e){r.show().find("div").empty().text(e)}function h(){function l(){try{u=i.contentWindow?i.contentWindow.document:i.contentDocument?i.contentDocument:i.document;if(u.body==null||u.body.innerHTML==""){if(--s)return setTimeout
(l,100);c();return n.fm.view.error("Unable to access iframe DOM after 50 tries")}a=e(u.body).html();n.fm.jquery>=141?f=e.parseJSON(a):/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?f=window.JSON&&window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))():f={error:"Unable to parse server response"}}catch(t){f={error:"Unable to parse server response"}}c();f.error&&n.fm.view.error(f.error,f.errorData);f.cwd&&n.fm.reload(f);f.tmb&&n.fm.tmb()}function c(){n.fm.lock();r.remove()}var r=e('<iframe name="'+t+'" name="'+t+'" src="about:blank"/>'),i=r[0],s=50,u,a,f;r.css({position:"absolute",top:"-1000px",left:"-1000px"}).appendTo("body").bind("load",function(){r.unbind("load");l()});n.fm.lock(!0);o.submit()}var t="el-finder-io-"+(new Date).getTime(),r=e('<div class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert"/><div/></div>'),i=this.fm.params.uplMaxSize?"<p>"+this.fm.i18n("Maximum allowed files size")+": "+this.fm.params.uplMaxSize+"</p>":"",s=e('<p class="el-finder-add-field"><span class="ui-state-default ui-corner-all"><em class="ui-icon ui-icon-circle-plus"/></span>'+this.fm.i18n("Add field")+"</p>").click(function(){e(this).before('<p><input type="file" name="upload[]"/></p>')}),o='<form method="post" enctype="multipart/form-data" action="'+n.fm.options.url+'" target="'+t+'"><input type="hidden" name="cmd" value="upload" /><input type="hidden" name="current" value="'+n.fm.cwd.hash+'" />',u=e("<div/>"),a=3;while(a--)o+='<p><input type="file" name="upload[]"/></p>';var f=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content");l!=null&&f!=null&&(o+='<input name="'+l+'" value="'+f+'" type="hidden" />');o=e(o+"</form>");u.append(o.append(r.hide()).prepend(i).append(s)).dialog({dialogClass:"el-finder-dialog",title:n.fm.i18n("Upload files"),modal:!0,resizable:!1,close:function(){n.fm.lockShortcuts()},buttons:{Cancel:function(){e(this).dialog("close")},Ok:function(){if(!e(":file[value]",o).length)return c(n.fm.i18n("Select at least one file to upload"));setTimeout(function(){n.fm.lock();e.browser.safari?e.ajax({url:n.fm.options.url,data:{cmd:"ping"},error:h,success:h}):h()});e(this).dialog("close")}}});n.fm.lockShortcuts(!0)};this.isAllowed=function(){return this.fm.cwd.write};this.cm=function(e){return e=="cwd"}},duplicate:function(e){var t=this;this.name="Duplicate";this.fm=e;this.exec=function(){this.fm.ajax({cmd:"duplicate",current:this.fm.cwd.hash,target:this.fm.selected[0]},function(e){t.fm.reload(e)})};this.isAllowed=function(){return this.fm.cwd.write&&this.fm.selected.length==1&&this.fm.getSelected()[0].read};this.cm=function(e){return e=="file"}},edit:function(t){var n=this;this.name="Edit text file";this.fm=t;this.exec=function(){var t=this.fm.getSelected(0);this.fm.lockShortcuts(!0);this.fm.ajax({cmd:"read",current:this.fm.cwd.hash,target:t.hash},function(r){n.fm.lockShortcuts(!0);var i=e("<textarea/>").val(r.content||"").keydown(function(t){t.stopPropagation();if(t.keyCode==9){t.preventDefault();if(e.browser.msie){var n=document.selection.createRange();n.text="	"+n.text;this.focus()}else{var r=this.value.substr(0,this.selectionStart),i=this.value.substr(this.selectionEnd);this.value=r+"	"+i;this.setSelectionRange(r.length+1,r.length+1)}}});e("<div/>").append(i).dialog({dialogClass:"el-finder-dialog",title:n.fm.i18n(n.name),modal:!0,width:500,close:function(){n.fm.lockShortcuts()},buttons:{Cancel:function(){e(this).dialog("close")},Ok:function(){var r=i.val();e(this).dialog("close");n.fm.ajax({cmd:"edit",current:n.fm.cwd.hash,target:t.hash,content:r},function(e){if(e.target){n.fm.cdc[e.target.hash]=e.target;n.fm.view.updateFile(e.target);n.fm.selectById(e.target.hash)}},{type:"POST"})}}})})};this.isAllowed=function(){if(n.fm.selected.length==1){var e=this.fm.getSelected()[0];return e.write&&e.read&&(e.mime.indexOf("text")==0||e.mime=="application/x-empty"||e.mime=="application/xml")}};this.cm=function(e){return e=="file"}},archive:function(t){var n=this;this.name="Create archive";this.fm=t;this.exec=function(t){var r={cmd:"archive",current:n.fm.cwd.hash,type:e.inArray(t,this.fm.params.archives)!=-1?t:this.fm.params.archives[0],name:n.fm.i18n("Archive")};this.fm.jquery>132?r.targets=n.fm.selected:r["targets[]"]=n.fm.selected;this.fm.ajax(r,function(e){n.fm.reload(e)})};this.isAllowed=function(){if(this.fm.cwd.write&&this.fm.selected.length){var e=this.fm.getSelected(),t=e.length;while(t--)if(e[t].read)return!0}return!1};this.cm=function(e){return e!="cwd"};this.argc=function(){var e,t=[];for(e=0;e<n.fm.params.archives.length;e++)t.push({"class":"archive",argc:n.fm.params.archives[e],text:n.fm.view.mime2kind(n.fm.params.archives[e])});return t}},extract:function(t){var n=this;this.name="Uncompress archive";this.fm=t;this.exec=function(){this.fm.ajax({cmd:"extract",current:this.fm.cwd.hash,target:this.fm.getSelected(0).hash},function(e){n.fm.reload(e)})};this.isAllowed=function(){var t=this.fm.params.extract,n=t&&t.length;return this.fm.cwd.write&&this.fm.selected.length==1&&this.fm.getSelected(0).read&&n&&e.inArray(this.fm.getSelected(0).mime,t)!=-1};this.cm=function(e){return e=="file"}},resize:function(t){var n=this;this.name="Resize image";this.fm=t;this.exec=function(){function a(){var e=parseInt(iw.val())||0,t=parseInt(ih.val())||0;if(e<=0||t<=0){e=i;t=s}else this==iw.get(0)?t=parseInt(e/o):e=parseInt(t*o);iw.val(e);ih.val(t)}var t=this.fm.getSelected();if(t[0]&&t[0].write&&t[0].dim){var r=t[0].dim.split("x"),i=parseInt(r[0]),s=parseInt(r[1]),o=i/s;iw=e('<input type="text" size="9" value="'+i+'" name="width"/>'),ih=e('<input type="text" size="9" value="'+s+'" name="height"/>'),f=e("<form/>").append(iw).append(" x ").append(ih).append(" px");iw.add(ih).bind("change",a);n.fm.lockShortcuts(!0);var u=e("<div/>").append(e("<div/>").text(n.fm.i18n("Dimensions")+":")).append(f).dialog({title:n.fm.i18n("Resize image"),dialogClass:"el-finder-dialog",width:230,modal:!0,close:function(){n.fm.lockShortcuts()},buttons:{Cancel:function(){e(this).dialog("close")},Ok:function(){var r=parseInt(iw.val())||0,o=parseInt(ih.val())||0;r>0&&r!=i&&o>0&&o!=s&&n.fm.ajax({cmd:"resize",current:n.fm.cwd.hash,target:t[0].hash,width:r,height:o},function(e){n.fm.reload(e)});e(this).dialog("close")}}})}};this.isAllowed=function(){return this.fm.selected.length==1&&this.fm.cdc[this.fm.selected[0]].write&&this.fm.cdc[this.fm.selected[0]].read&&this.fm.cdc[this.fm.selected[0]].resize};this.cm=function(e){return e=="file"}},icons:function(t){this.name="View as icons";this.fm=t;this.exec=function(){this.fm.view.win.addClass("el-finder-disabled");this.fm.setView("icons");this.fm.updateCwd();this.fm.view.win.removeClass("el-finder-disabled");e("div.image",this.fm.view.cwd).length&&this.fm.tmb()};this.isAllowed=function(){return this.fm.options.view!="icons"};this.cm=function(e){return e=="cwd"}},list:function(e){this.name="View as list";this.fm=e;this.exec=function(){this.fm.view.win.addClass("el-finder-disabled");this.fm.setView("list");this.fm.updateCwd();this.fm.view.win.removeClass("el-finder-disabled")};this.isAllowed=function(){return this.fm.options.view!="list"};this.cm=function(e){return e=="cwd"}},help:function(t){this.name="Help";this.fm=t;this.exec=function(){var t,n=this.fm.i18n("helpText"),r,i,s;t='<div class="el-finder-logo"/><strong>'+this.fm.i18n("elFinder: Web file manager")+"</strong><br/>"+this.fm.i18n("Version")+": "+this.fm.version+"<br/>"+"jQuery/jQueryUI: "+e().jquery+"/"+e.ui.version+'<br clear="all"/>'+'<p><strong><a href="http://elrte.org/'+this.fm.options.lang+'/elfinder" target="_blank">'+this.fm.i18n("Donate to support project development")+"</a></strong></p>"+'<p><a href="http://elrte.org/redmine/projects/elfinder/wiki" target="_blank">'+this.fm.i18n("elFinder documentation")+"</a></p>";t+="<p>"+(n!="helpText"?n:"elFinder works similar to file manager on your computer. <br /> To make actions on files/folders use icons on top panel. If icon action it is not clear for you, hold mouse cursor over it to see the hint. <br /> Manipulations with existing files/folders can be done through the context menu (mouse right-click).<br/> To copy/delete a group of files/folders, select them using Shift/Alt(Command) + mouse left-click.")+"</p>";t+="<p><strong>"+this.fm.i18n("elFinder support following shortcuts")+":</strong><ul>"+"<li><kbd>Ctrl+A</kbd> - "+this.fm.i18n("Select all files")+"</li>"+"<li><kbd>Ctrl+C/Ctrl+X/Ctrl+V</kbd> - "+this.fm.i18n("Copy/Cut/Paste files")+"</li>"+"<li><kbd>Enter</kbd> - "+this.fm.i18n("Open selected file/folder")+"</li>"+"<li><kbd>Space</kbd> - "+this.fm.i18n("Open/close QuickLook window")+"</li>"+"<li><kbd>Delete/Cmd+Backspace</kbd> - "+this.fm.i18n("Remove selected files")+"</li>"+"<li><kbd>Ctrl+I</kbd> - "+this.fm.i18n("Selected files or current directory info")+"</li>"+"<li><kbd>Ctrl+N</kbd> - "+this.fm.i18n("Create new directory")+"</li>"+"<li><kbd>Ctrl+U</kbd> - "+this.fm.i18n("Open upload files form")+"</li>"+"<li><kbd>Left arrow</kbd> - "+this.fm.i18n("Select previous file")+"</li>"+"<li><kbd>Right arrow </kbd> - "+this.fm.i18n("Select next file")+"</li>"+"<li><kbd>Ctrl+Right arrow</kbd> - "+this.fm.i18n("Open selected file/folder")+"</li>"+"<li><kbd>Ctrl+Left arrow</kbd> - "+this.fm.i18n("Return into previous folder")+"</li>"+"<li><kbd>Shift+arrows</kbd> - "+this.fm.i18n("Increase/decrease files selection")+"</li></ul>"+"</p><p>"+this.fm.i18n("Contacts us if you need help integrating elFinder in you products")+": dev@std42.ru</p>";r='<div class="el-finder-help-std"/><p>'+this.fm.i18n("Javascripts/PHP programming: Dmitry (dio) Levashov, dio@std42.ru")+"</p>"+"<p>"+this.fm.i18n("Python programming, techsupport: Troex Nevelin, troex@fury.scancode.ru")+"</p>"+"<p>"+this.fm.i18n("Design: Valentin Razumnih")+"</p>"+"<p>"+this.fm.i18n("Chezh localization")+": Roman Matěna, info@romanmatena.cz</p>"+"<p>"+this.fm.i18n("Chinese (traditional) localization")+": Tad, tad0616@gmail.com</p>"+"<p>"+this.fm.i18n("Dutch localization")+': Kurt Aerts, <a href="http://ilabsolutions.net/" target="_blank">http://ilabsolutions.net</a></p>'+"<p>"+this.fm.i18n("Greek localization")+": Panagiotis Skarvelis</p>"+"<p>"+this.fm.i18n("Hungarian localization")+": Viktor Tamas, tamas.viktor@totalstudio.hu</p>"+"<p>"+this.fm.i18n("Italian localization")+":  Ugo Punzolo, sadraczerouno@gmail.com</p>"+"<p>"+this.fm.i18n("Latvian localization")+":  Uldis Plotiņš, uldis.plotins@gmail.com</p>"+"<p>"+this.fm.i18n("Poland localization")+":  Darek Wapiński, darek@wapinski.us</p>"+"<p>"+this.fm.i18n("Spanish localization")+': Alex (xand) Vavilin, xand@xand.es, <a href="http://xand.es" target="_blank">http://xand.es</a></p>'+"<p>"+this.fm.i18n("Icons")+': <a href="http://pixelmixer.ru/" target="_blank">pixelmixer</a>,  <a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank">Famfam silk icons</a>, <a href="http://www.fatcow.com/free-icons/" target="_blank">Fatcow icons</a>'+"</p>"+"<p>"+this.fm.i18n('Copyright: <a href="http://www.std42.ru" target="_blank">Studio 42 LTD</a>')+"</p>"+"<p>"+this.fm.i18n("License: BSD License")+"</p>"+"<p>"+this.fm.i18n('Web site: <a href="http://elrte.org/elfinder/" target="_blank">elrte.org/elfinder</a>')+"</p>";i='<div class="el-finder-logo"/><strong><a href="http://www.eldorado-cms.ru" target="_blank">ELDORADO.CMS</a></strong><br/>'+this.fm.i18n("Simple and usefull Content Management System")+"<hr/>"+this.fm.i18n("Support project development and we will place here info about you");s='<ul><li><a href="#el-finder-help-h">'+this.fm.i18n("Help")+'</a></li><li><a href="#el-finder-help-a">'+this.fm.i18n("Authors")+'</a><li><a href="#el-finder-help-sp">'+this.fm.i18n("Sponsors")+"</a></li></ul>"+'<div id="el-finder-help-h"><p>'+t+"</p></div>"+'<div id="el-finder-help-a"><p>'+r+"</p></div>"+'<div id="el-finder-help-sp"><p>'+i+"</p></div>";var o=e("<div/>").html(s).dialog({width:617,title:this.fm.i18n("Help"),dialogClass:"el-finder-dialog",modal:!0,close:function(){o.tabs("destroy").dialog("destroy").remove()},buttons:{Ok:function(){e(this).dialog("close")}}}).tabs()};this.cm=function(e){return e=="cwd"}}}})(jQuery);(function(e){elFinder.prototype.quickLook=function(t,n){function f(){r.media.hide().empty();r.win.attr("class","el-finder-ql").css("z-index",r.fm.zIndex);r.title.empty();r.ico.attr("style","").show();r.add.hide().empty();r._hash=""}function l(){var e=r.fm.getSelected(0);f();r._hash=e.hash;r.title.text(e.name);r.win.addClass(r.fm.view.mime2class(e.mime));r.name.text(e.name);r.kind.text(r.fm.view.mime2kind(e.link?"symlink":e.mime));r.size.text(r.fm.view.formatSize(e.size));r.date.text(r.fm.i18n("Modified")+": "+r.fm.view.formatDate(e.date));e.dim&&r.add.append("<span>"+e.dim+" px</span>").show();e.tmb&&r.ico.css("background",'url("'+e.tmb+'") 0 0 no-repeat');if(e.url){r.url.text(e.url).attr("href",e.url).show();for(var t in r.plugins)if(r.plugins[t].test&&r.plugins[t].test(e.mime,r.mimes,e.name)){r.plugins[t].show(r,e);return}}else r.url.hide();r.win.css({width:"420px",height:"auto"})}var r=this;this.fm=t;this._hash="";this.title=e("<strong/>");this.ico=e("<p/>");this.info=e("<label/>");this.media=e('<div class="el-finder-ql-media"/>').hide();this.name=e('<span class="el-finder-ql-name"/>');this.kind=e('<span class="el-finder-ql-kind"/>');this.size=e('<span class="el-finder-ql-size"/>');this.date=e('<span class="el-finder-ql-date"/>');this.url=e('<a href="#"/>').hide().click(function(t){t.preventDefault();window.open(e(this).attr("href"));r.hide()});this.add=e("<div/>");this.content=e('<div class="el-finder-ql-content"/>');this.win=e('<div class="el-finder-ql"/>').hide().append(e('<div class="el-finder-ql-drag-handle"/>').append(e('<span class="ui-icon ui-icon-circle-close"/>').click(function(){r.hide()})).append(this.title)).append(this.ico).append(this.media).append(this.content.append(this.name).append(this.kind).append(this.size).append(this.date).append(this.url).append(this.add)).appendTo("body").draggable({handle:".el-finder-ql-drag-handle"}).resizable({minWidth:420,minHeight:150,resize:function(){if(r.media.children().length){var e=r.media.children(":first");switch(e[0].nodeName){case"IMG":var t=e.width(),n=e.height(),i=r.win.width(),s=r.win.css("height")=="auto"?350:r.win.height()-r.content.height()-r.th,o=t>i||n>s?Math.min(Math.min(i,t)/t,Math.min(s,n)/n):Math.min(Math.max(i,t)/t,Math.max(s,n)/n);e.css({width:Math.round(e.width()*o),height:Math.round(e.height()*o)});break;case"IFRAME":case"EMBED":e.css("height",r.win.height()-r.content.height()-r.th);break;case"OBJECT":e.children("embed").css("height",r.win.height()-r.content.height()-r.th)}}}});this.th=parseInt(this.win.children(":first").css("height"))||18;this.mimes={"image/jpeg":"jpg","image/gif":"gif","image/png":"png"};for(var i=0;i<navigator.mimeTypes.length;i++){var s=navigator.mimeTypes[i].type;s&&s!="*"&&(this.mimes[s]=navigator.mimeTypes[i].suffixes)}if(e.browser.safari&&navigator.platform.indexOf("Mac")!=-1||e.browser.msie)this.mimes["application/pdf"]="pdf";else for(var o=0;o<navigator.plugins.length;o++)for(var u=0;u<navigator.plugins[o].length;u++){var a=navigator.plugins[o][u].description.toLowerCase();if(a.substring(0,a.indexOf(" "))=="pdf"){this.mimes["application/pdf"]="pdf";break}}this.mimes["image/x-bmp"]&&(this.mimes["image/x-ms-bmp"]="bmp");e.browser.msie&&!this.mimes["application/x-shockwave-flash"]&&(this.mimes["application/x-shockwave-flash"]="swf");this.show=function(){if(this.win.is(":hidden")&&r.fm.selected.length==1){l();var t=r.fm.selected[0],n=r.fm.view.cwd.find('[key="'+t+'"]'),i=n.offset();r.fm.lockShortcuts(!0);this.win.css({width:n.width()-20,height:n.height(),left:i.left,top:i.top,opacity:0}).show().animate({width:420,height:150,opacity:1,top:Math.round(e(window).height()/5),left:e(window).width()/2-210},450,function(){r.win.css({height:"auto"});r.fm.lockShortcuts()})}};this.hide=function(){if(this.win.is(":visible")){var e,t=r.fm.view.cwd.find('[key="'+this._hash+'"]');if(t){e=t.offset();this.media.hide(200);this.win.animate({width:t.width()-20,height:t.height(),left:e.left,top:e.top,opacity:0},350,function(){r.fm.lockShortcuts();f();r.win.hide().css("height","auto")})}else{this.win.fadeOut(200);f();r.fm.lockShortcuts()}}};this.toggle=function(){this.win.is(":visible")?this.hide():this.show()};this.update=function(){this.fm.selected.length!=1?this.hide():this.win.is(":visible")&&this.fm.selected[0]!=this._hash&&l()};this.mediaHeight=function(){return this.win.is(":animated")||this.win.css("height")=="auto"?315:this.win.height()-this.content.height()-this.th}};elFinder.prototype.quickLook.prototype.plugins={image:new function(){this.test=function(e,t){return e.match(/^image\//)};this.show=function(t,n){function s(e){var n=e.width(),r=e.height(),i=t.win.is(":animated"),s=i?420:t.win.width(),o=i||t.win.css("height")=="auto"?315:t.win.height()-t.content.height()-t.th,u=n>s||r>o?Math.min(Math.min(s,n)/n,Math.min(o,r)/r):Math.min(Math.max(s,n)/n,Math.max(o,r)/r);t.fm.lockShortcuts(!0);t.ico.hide();e.css({width:t.ico.width(),height:t.ico.height()}).show().animate({width:Math.round(u*n),height:Math.round(u*r)},450,function(){t.fm.lockShortcuts()})}var r,i;t.mimes[n.mime]&&n.hash==t._hash&&e("<img/>").hide().appendTo(t.media.show()).attr("src",n.url+(e.browser.msie||e.browser.opera?"?"+Math.random():"")).load(function(){i=e(this).unbind("load");n.hash==t._hash&&(t.win.is(":animated")?setTimeout(function(){s(i)},330):s(i))})}},text:new function(){this.test=function(e,t){return e.indexOf("text")==0&&e.indexOf("rtf")==-1||e.match(/application\/(xml|javascript|json)/)};this.show=function(e,t){if(t.hash==e._hash){e.ico.hide();e.media.append('<iframe src="'+t.url+'" style="height:'+e.mediaHeight()+'px" />').show()}}},swf:new function(){this.test=function(e,t){return e=="application/x-shockwave-flash"&&t[e]};this.show=function(e,t){if(t.hash==e._hash){e.ico.hide();var n=e.media.append('<embed pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+t.url+'" style="width:100%;height:'+e.mediaHeight()+'px" type="application/x-shockwave-flash" />');e.win.is(":animated")?n.slideDown(450):n.show()}}},audio:new function(){this.test=function(e,t){return e.indexOf("audio")==0&&t[e]};this.show=function(e,t){if(t.hash==e._hash){e.ico.hide();var n=e.win.is(":animated")||e.win.css("height")=="auto"?100:e.win.height()-e.content.height()-e.th;e.media.append('<embed src="'+t.url+'" style="width:100%;height:'+n+'px" />').show()}}},video:new function(){this.test=function(e,t){return e.indexOf("video")==0&&t[e]};this.show=function(e,t){if(t.hash==e._hash){e.ico.hide();e.media.append('<embed src="'+t.url+'" style="width:100%;height:'+e.mediaHeight()+'px" />').show()}}},pdf:new function(){this.test=function(e,t){return e=="application/pdf"&&t[e]};this.show=function(e,t){if(t.hash==e._hash){e.ico.hide();e.media.append('<embed src="'+t.url+'" style="width:100%;height:'+e.mediaHeight()+'px" />').show()}}}}})(jQuery);(function(e){elFinder.prototype.eventsManager=function(t,n){function i(t,n){var i,s,o;if(!e("[key]",r.cwd).length)return;if(r.fm.selected.length==0){i=e("[key]:"+(t?"first":"last"),r.cwd);r.fm.select(i)}else if(n){i=e(".ui-selected:"+(t?"last":"first"),r.cwd);s=i[t?"next":"prev"]("[key]");s.length&&(i=s);r.fm.select(i,!0)}else{r.pointer&&(o=e('[key="'+r.pointer+'"].ui-selected',r.cwd));if(!o||!o.length)o=e(".ui-selected:"+(t?"last":"first"),r.cwd);i=o[t?"next":"prev"]("[key]");if(!i.length)i=o;else if(!i.hasClass("ui-selected"))r.fm.select(i);else if(!o.hasClass("ui-selected"))r.fm.unselect(i);else{s=o[t?"prev":"next"]("[key]");if(!s.length||!s.hasClass("ui-selected"))r.fm.unselect(o);else{while((s=t?i.next("[key]"):i.prev("[key]"))&&i.hasClass("ui-selected"))i=s;r.fm.select(i)}}}r.pointer=i.attr("key");r.fm.checkSelectedPos(t)}var r=this;this.lock=!1;this.fm=t;this.ui=t.ui;this.tree=t.view.tree;this.cwd=t.view.cwd;this.pointer="";this.init=function(){var t=this,n=!1;t.lock=!1;this.cwd.bind("click",function(n){var r=e(n.target);if(r.hasClass("ui-selected"))t.fm.unselectAll();else{r.attr("key")||(r=r.parent("[key]"));n.ctrlKey||n.metaKey?t.fm.toggleSelect(r):t.fm.select(r,!0)}}).bind(window.opera?"click":"contextmenu",function(r){if(window.opera&&!r.ctrlKey)return;r.preventDefault();r.stopPropagation();var i=e(r.target);e.browser.mozilla&&(n=!0);i.hasClass("el-finder-cwd")?t.fm.unselectAll():t.fm.select(i.attr("key")?i:i.parent("[key]"));t.fm.quickLook.hide();t.fm.ui.showMenu(r)}).selectable({filter:"[key]",delay:300,stop:function(){t.fm.updateSelect();t.fm.log("mouseup")}});e(document).bind("click",function(r){!n&&t.fm.ui.hideMenu();n=!1;e("input",t.cwd).trigger("change");e(r.target).is("input,textarea,select")||e("input,textarea").blur()});e("input,textarea").live("focus",function(e){t.lock=!0}).live("blur",function(e){t.lock=!1});this.tree.bind("select",function(n){t.tree.find("a").removeClass("selected");e(n.target).addClass("selected").parents("li:has(ul)").children("ul").show().prev().children("div").addClass("expanded")});if(this.fm.options.places){this.fm.view.plc.click(function(n){n.preventDefault();var r=e(n.target),i=r.attr("key"),s;if(i)i!=t.fm.cwd.hash&&t.ui.exec("open",n.target);else if(n.target.nodeName=="A"||n.target.nodeName=="DIV"){s=t.fm.view.plc.find("ul");if(s.children().length){s.toggle(300);t.fm.view.plc.children("li").find("div").toggleClass("expanded")}}});this.fm.view.plc.droppable({accept:"(div,tr).directory",tolerance:"pointer",over:function(){e(this).addClass("el-finder-droppable")},out:function(){e(this).removeClass("el-finder-droppable")},drop:function(n,r){e(this).removeClass("el-finder-droppable");var i=!1;r.helper.children(".directory:not(.noaccess,.dropbox)").each(function(){if(t.fm.addPlace(e(this).attr("key"))){i=!0;e(this).hide()}});if(i){t.fm.view.renderPlaces();t.updatePlaces();t.fm.view.plc.children("li").children("div").trigger("click")}r.helper.children("div:visible").length||r.helper.hide()}})}e(document).bind(e.browser.mozilla||e.browser.opera?"keypress":"keydown",function(e){var n=e.ctrlKey||e.metaKey;if(t.lock)return;switch(e.keyCode){case 37:case 38:e.stopPropagation();e.preventDefault();e.keyCode==37&&n?t.ui.execIfAllowed("back"):i(!1,!e.shiftKey);break;case 39:case 40:e.stopPropagation();e.preventDefault();n?t.ui.execIfAllowed("open"):i(!0,!e.shiftKey)}});e(document).bind(e.browser.opera?"keypress":"keydown",function(e){if(t.lock)return;switch(e.keyCode){case 32:e.preventDefault();e.stopPropagation();t.fm.quickLook.toggle();break;case 27:t.fm.quickLook.hide()}});this.fm.options.disableShortcuts||e(document).bind("keydown",function(e){var n=e.ctrlKey||e.metaKey;if(t.lock)return;switch(e.keyCode){case 8:if(n&&t.ui.isCmdAllowed("rm")){e.preventDefault();t.ui.exec("rm")}break;case 13:if(t.ui.isCmdAllowed("select"))return t.ui.exec("select");t.ui.execIfAllowed("open");break;case 46:t.ui.execIfAllowed("rm");break;case 65:if(n){e.preventDefault();t.fm.selectAll()}break;case 67:n&&t.ui.execIfAllowed("copy");break;case 73:if(n){e.preventDefault();t.ui.exec("info")}break;case 78:if(n){e.preventDefault();t.ui.execIfAllowed("mkdir")}break;case 85:if(n){e.preventDefault();t.ui.execIfAllowed("upload")}break;case 86:n&&t.ui.execIfAllowed("paste");break;case 88:n&&t.ui.execIfAllowed("cut");break;case 113:t.ui.execIfAllowed("rename")}})};this.updateNav=function(){e("a",this.tree).click(function(t){t.preventDefault();var n=e(this),i;if(t.target.nodeName=="DIV"&&e(t.target).hasClass("collapsed"))e(t.target).toggleClass("expanded").parent().next("ul").toggle(300);else if(n.attr("key")!=r.fm.cwd.hash)n.hasClass("noaccess")||n.hasClass("dropbox")?r.fm.view.error("Access denied"):r.ui.exec("open",n.trigger("select")[0]);else{i=n.children(".collapsed");if(i.length){i.toggleClass("expanded");n.next("ul").toggle(300)}}});e("a:not(.noaccess,.readonly)",this.tree).droppable({tolerance:"pointer",accept:"div[key],tr[key]",over:function(){e(this).addClass("el-finder-droppable")},out:function(){e(this).removeClass("el-finder-droppable")},drop:function(t,n){e(this).removeClass("el-finder-droppable");r.fm.drop(t,n,e(this).attr("key"))}});this.fm.options.places&&this.updatePlaces()};this.updatePlaces=function(){this.fm.view.plc.children("li").find("li").draggable({scroll:!1,stop:function(){if(r.fm.removePlace(e(this).children("a").attr("key"))){e(this).remove();e("li",r.fm.view.plc.children("li")).length||r.fm.view.plc.children("li").find("div").removeClass("collapsed expanded").end().children("ul").hide()}}})};this.updateCwd=function(){e("[key]",this.cwd).bind("dblclick",function(t){r.fm.select(e(this),!0);r.ui.exec(r.ui.isCmdAllowed("select")?"select":"open")}).draggable({delay:3,addClasses:!1,appendTo:".el-finder-cwd",revert:!0,drag:function(e,t){t.helper.toggleClass("el-finder-drag-copy",e.shiftKey||e.ctrlKey)},helper:function(){var t=e(this),n=e('<div class="el-finder-drag-helper"/>'),i=0;!t.hasClass("ui-selected")&&r.fm.select(t,!0);r.cwd.find(".ui-selected").each(function(t){var s=r.fm.options.view=="icons"?e(this).clone().removeClass("ui-selected"):e(r.fm.view.renderIcon(r.fm.cdc[e(this).attr("key")]));(i++==0||i%12==0)&&s.css("margin-left",0);n.append(s)});return n.css("width",(i<=12?85+(i-1)*29:387)+"px")}}).filter(".directory").droppable({tolerance:"pointer",accept:"div[key],tr[key]",over:function(){e(this).addClass("el-finder-droppable")},out:function(){e(this).removeClass("el-finder-droppable")},drop:function(t,n){e(this).removeClass("el-finder-droppable");r.fm.drop(t,n,e(this).attr("key"))}});e.browser.msie&&e("*",this.cwd).attr("unselectable","on").filter("[key]").bind("dragstart",function(){r.cwd.selectable("disable").removeClass("ui-state-disabled ui-selectable-disabled")}).bind("dragstop",function(){r.cwd.selectable("enable")})}}})(jQuery);